{% extends "base.html" %}

{% block title %}HashBot - Explore Agents{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-3xl font-bold">Explore Agents</h1>
    <p class="text-sm opacity-60 mt-1">Discover public agents created by the community</p>
  </div>
  <div class="badge badge-primary badge-outline" id="explore-total">Loading...</div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="explore-grid">
  <div class="col-span-full text-center py-12 opacity-60">
    <span class="loading loading-spinner loading-lg"></span>
    <p class="mt-2">Loading agents...</p>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadExplore() {
  const grid = document.getElementById('explore-grid');
  try {
    const resp = await fetch('/api/agents/');
    const data = await resp.json();
    const agents = data.agents || [];

    document.getElementById('explore-total').textContent = `${agents.length} public agents`;

    if (agents.length === 0) {
      grid.innerHTML = `
        <div class="col-span-full text-center py-12">
          <p class="text-lg opacity-60">No public agents yet</p>
          <p class="text-sm opacity-40 mt-2">Create an agent and make it public to appear here</p>
        </div>`;
      return;
    }

    grid.innerHTML = '';
    agents.forEach(agent => {
      const card = document.createElement('div');
      card.className = 'card bg-base-100 shadow hover:shadow-lg transition-all';
      card.innerHTML = `
        <div class="card-body">
          <div class="flex items-start justify-between">
            <h2 class="card-title">${agent.name}</h2>
            ${agent.price_per_call > 0
              ? `<span class="badge badge-warning badge-sm">${agent.price_per_call} ${agent.currency}</span>`
              : '<span class="badge badge-success badge-sm">Free</span>'}
          </div>
          <p class="opacity-60 text-sm">${agent.description || 'No description'}</p>
          <div class="text-xs opacity-40 mt-1">Created: ${new Date(agent.created_at).toLocaleDateString()}</div>
          <div class="card-actions justify-end mt-4">
            <a href="/dashboard/agents/${agent.id}" class="btn btn-primary btn-sm">Chat</a>
          </div>
        </div>`;
      grid.appendChild(card);
    });
  } catch {
    grid.innerHTML = '<div class="col-span-full alert alert-error">Failed to load agents</div>';
  }
}

loadExplore();
</script>
{% endblock %}
